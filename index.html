<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PMSDNW5N3Z"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-PMSDNW5N3Z');
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#ffffff">
  <meta name="color-scheme" content="only light">
  <title>Vibesim</title>
  <link rel="stylesheet" href="style.css">
  <script>
    window.MathJax = {
      tex: { inlineMath: [["$", "$"], ["\\(", "\\)"]] },
      svg: { fontCache: "global" },
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" defer></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand-title">Vibesim</div>
      <div class="brand-subtitle">A block diagram control system simulator</div>
    </div>
  </header>

  <main class="layout">
    <div class="panel-carousel">
      <aside id="blockLibrary" class="toolbox panel panel-left">
        <h2>Block Library</h2>
        <details class="tool-group">
          <summary>Source</summary>
          <button class="tool" data-type="constant">Constant</button>
          <button class="tool" data-type="step">Step</button>
          <button class="tool" data-type="ramp">Ramp</button>
          <button class="tool" data-type="impulse">Impulse</button>
          <button class="tool" data-type="sine">Sine</button>
          <button class="tool" data-type="chirp">Chirp</button>
          <button class="tool" data-type="noise">Noise</button>
          <button class="tool" data-type="fileSource">File</button>
          <button class="tool" data-type="labelSource">Label</button>
        </details>
        <details class="tool-group">
          <summary>Continuous</summary>
          <button class="tool" data-type="integrator">Integrator</button>
          <button class="tool" data-type="tf">Transfer Function</button>
          <button class="tool" data-type="delay">Delay</button>
          <button class="tool" data-type="stateSpace">State Space</button>
          <button class="tool" data-type="lpf">LPF</button>
          <button class="tool" data-type="hpf">HPF</button>
          <button class="tool" data-type="derivative">Derivative</button>
          <button class="tool" data-type="pid">PID</button>
        </details>
        <details class="tool-group">
          <summary>Math</summary>
          <button class="tool" data-type="gain">Gain</button>
          <button class="tool" data-type="sum">Addition</button>
          <button class="tool" data-type="mult">Multiplication</button>
        </details>
        <details class="tool-group">
          <summary>Discrete</summary>
          <button class="tool" data-type="zoh">ZOH</button>
          <button class="tool" data-type="foh">FOH</button>
          <button class="tool" data-type="dtf">Discrete TF</button>
          <button class="tool" data-type="ddelay">Discrete Delay</button>
          <button class="tool" data-type="dstateSpace">Discrete State Space</button>
        </details>
        <details class="tool-group">
          <summary>Nonlinear</summary>
          <button class="tool" data-type="saturation">Saturation</button>
          <button class="tool" data-type="rate">Rate Limit</button>
          <button class="tool" data-type="backlash">Backlash</button>
        </details>
        <details class="tool-group">
          <summary>Sink</summary>
          <button class="tool" data-type="scope">Scope</button>
          <button class="tool" data-type="fileSink">Output File</button>
          <button class="tool" data-type="labelSink">Label</button>
        </details>
      </aside>

      <div class="right-column">
        <div id="examplesPanel" class="examples-panel panel-card">
          <h3>Examples</h3>
          <div id="examplesList" class="button-stack"></div>
        </div>
        <div id="simPanel" class="panel-card sim-panel">
          <h3>Sim Properties</h3>
          <label class="param">Name
            <input id="diagramName" type="text" value="vibesim">
          </label>
          <div class="runtime-row">
            <label class="runtime">Runtime (s)
              <input id="runtimeInput" type="number" value="10" step="0.5" min="0.1">
            </label>
            <button class="secondary" data-action="run">Run</button>
          </div>
          <div class="button-row">
            <button id="loadBtn" class="secondary">Load</button>
            <button id="saveBtn" class="secondary">Save</button>
            <button id="clearBtn" class="danger">Clear</button>
          </div>
          <input id="loadInput" type="file" accept=".yaml,.yml,text/yaml" hidden>
          <div id="status" class="status">Idle</div>
        </div>

        <div id="inspector" class="inspector panel-card">
          <h3>Block Properties</h3>
          <div id="inspectorBody" class="inspector-body">Select a block or wire.</div>
          <div class="button-row">
            <button id="rotateSelection" class="secondary">Rotate</button>
            <button id="deleteSelection" class="danger">Delete</button>
          </div>
        </div>
        <div id="variablesPanel" class="variables-panel panel-card">
          <h3>Variables</h3>
          <textarea id="variablesInput" rows="6" placeholder="k=2&#10;w=3.14"></textarea>
          <button id="applyVariables" class="secondary">Apply</button>
          <div id="variablesPreview" class="variables-preview"></div>
        </div>
        <div id="codegenPanel" class="panel-card codegen-panel">
          <h3>Code Generation</h3>
          <div class="codegen-row">
            <label class="param">Language
              <select id="codegenLang">
                <option value="c">C</option>
                <option value="python">Python</option>
                <option value="tikz">TikZ</option>
              </select>
            </label>
            <label class="param param-inline">
              <span>Include main()</span>
              <input id="codegenIncludeMain" type="checkbox" checked>
            </label>
          </div>
          <label class="param">Sample time (s)
            <input id="codegenDt" type="number" value="0.01" step="0.001" min="0.0001">
          </label>
          <button id="codegenBtn" class="secondary">Generate</button>
        </div>
        <div id="stabilityPanel" class="panel-card stability-panel">
          <h3>Stability Margins</h3>
          <label class="param">Loop
            <select id="marginLoopSelect"></select>
          </label>
          <pre id="marginOutputText" class="margin-output">No loops detected.</pre>
        </div>
        <div id="debugPanel" class="debug-panel panel-card">
          <h3>Debug</h3>
          <button id="copyDebug" class="secondary">Copy debug</button>
          <pre id="debugLog">Routing debug output will appear here.</pre>
        </div>
      </div>
    </div>

    <section class="workspace">
      <div id="canvas">
        <div class="floating-controls">
          <button id="runBtn" class="floating-btn" aria-label="Run" title="Run" data-action="run">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M7 5l12 7-12 7z" />
            </svg>
          </button>
          <button id="homeBtn" class="floating-btn" aria-label="Home" title="Home">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 11l8-6 8 6M6 10v9h12v-9" />
            </svg>
          </button>
          <button id="zoomInBtn" class="floating-btn" aria-label="Zoom in" title="Zoom in">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="11" cy="11" r="7" />
              <path d="M11 8v6M8 11h6M16.5 16.5L21 21" />
            </svg>
          </button>
          <button id="zoomOutBtn" class="floating-btn" aria-label="Zoom out" title="Zoom out">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="11" cy="11" r="7" />
              <path d="M8 11h6M16.5 16.5L21 21" />
            </svg>
          </button>
        </div>
        <svg id="svgCanvas">
          <g id="wireLayer"></g>
          <g id="blockLayer"></g>
          <g id="overlayLayer"></g>
        </svg>
      </div>
    </section>
  </main>

  <script type="module" src="app.js"></script>
</body>
</html>
